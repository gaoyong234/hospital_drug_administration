<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../static/plugins/jQuery/jquery-2.2.3.min.js"></script>
    <link rel="stylesheet" href="../static/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="../static/plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/plugins/angularjs/toaster.min.css">
    <script src="../static/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../static/plugins/angularjs/angular.min.js"></script>
    <link rel="stylesheet" href="../static/plugins/angularjs/pagination.css">
    <script type="text/javascript" src="../static/plugins/angularjs/pagination.js"></script>
    <style>
        label { float: left; width: 10em; margin-right: 1em; text-align: right; }
    </style>
    <script>
       var app= angular.module("myApp",["pagination"]);
       app.controller("myContr",function ($scope,$http) {
        $scope.addClick=function () {

        }
           $scope.paginationConf={
               currentPage: 1,  				//当前页
               totalItems: 10,					//总记录数
               itemsPerPage: 10,				//每页记录数
               perPageOptions: [5,10, 20, 30, 40, 50], //分页选项，下拉选择一页多少条记录
               onChange: function () {
                   $scope.find($scope.paginationConf.currentPage,$scope.paginationConf.itemsPerPage)
               }
           }
           $scope.drug={
               pageNum:0,
               pageSize:10
           }
           $scope.find=function(pageNum,items) {
               if (pageNum==null||pageNum==""){
                   pageNum=1;
               }
               $scope.drug.pageNum=pageNum;
               $scope.drug.pageSize=items;
               var druglist=$scope.drug;
               console.log(druglist)
               $http({
                   url:"/items/conditionfand",
                   method:"post",
                   params: druglist
                   ,
               }).success(function (response) {
                   $scope.lists=response.list;
                   $scope.item=new Date();
                   $scope.paginationConf.totalItems=response.total;
               })

           }


       })


    </script>
    <script type="text/javascript">
        var demo=false;
        $(function () {
            $("#addition input").blur(function () {
                $(this).next().html("");
                $(this).next().css("color","black");
                if (this.value!=null&&this.value!=""){
                    demo=true;
                }else{
                    $(this).next().html("不能为空");
                    $(this).next().css("color","red");
                    demo=false;
                }
            })
        })

        var lists;
        function save() {
            var did = $("[name='diId']").val();
           var commonName=$("[name='commonName']").val();
           var dosageForm=$("[name='dosageForm']").val();
          var  speciflcation=$("[name='speciflcation']").val();
           var unitId=$("[name='unitId']").val();
           var coefficient=$("[name='coefficient']").val();
          var  drugCategoryName=$("[name='drugCategoryName']").val();
           var drugStateName=$("[name='drugStateName']").val();
            demo = did != null && did != "" && commonName != null && commonName != "" && dosageForm != null && dosageForm != "" && speciflcation != null && speciflcation != "" && unitId != null && unitId != "" && coefficient != null && coefficient != "" && drugCategoryName != null && drugCategoryName != "" && drugStateName != null && drugStateName != "";
            console.log(demo)
            if (demo){
                $.ajax({
                    url:"/items/fandId",
                    method:"get",
                    data:{
                        "diId":did,
                        "drugCategoryName":drugCategoryName,
                        "drugStateName":drugStateName
                    },
                    dataType:"json",
                    success:function (data) {
                         lists = eval(data);
                    }
                })
                var dem=false;
                var li=0;
               if (lists[0]!=0&&lists[0]!=null){
                   dem=true;
               }else{
                   dem=false;
               }

                if(dem){
                    $.ajax({
                        url: "/items/addDrugItems",
                        dataType: "json",
                        type: "post",
                        data: addform,
                        success: function (data) {
                            if (data > 0) {
                                document.getElementById("headline").innerHTML="成功提示信息"
                                document.getElementById("whether").innerHTML="您的操作成功"
                                alert("增加成功")
                            } else {
                                document.getElementById("headline").innerHTML="失败提示信息"
                                document.getElementById("whether").innerHTML="您的操作失败,请尝试刷新页面,重新操作"
                                alert("数据库增加失败")
                            }
                        }
                    })
                }else {
                    document.getElementById("headline").innerHTML="失败提示信息"
                    document.getElementById("whether").innerHTML="您的操作失败,请尝试刷新页面,重新操作"
                    // document.getElementById("lose").innerHTML=lists[li];
                    alert("失败-已存在")
                }


            }else {
                document.getElementById("headline").innerHTML="失败提示信息"
                document.getElementById("whether").innerHTML="因数据不完整,您的操作失败,请尝试刷新页面,重新操作"
            }
        }

    </script>

</head>
<body ng-app="myApp" ng-controller="myContr">
<div>
   <h5 class="alert alert-infoalert alert-info">药品品目查询</h5>
<table class="table table-bordered table-striped">
<tr>
    <td>药品品目号:<input ng-model="drug.diId"></td>
    <td>通用名:<input ng-model="drug.commonName"></td>

</tr>
    <tr>
        <td>剂型:<input ng-model="drug.dosageForm"></td>
        <td>规格:<input ng-model="drug.speciflcation"></td>
    </tr>
    <tr>
        <td>单位:<input ng-model="drug.unitId"></td>
        <td>转换系数:<input ng-model="drug.coefficient"></td>
    </tr>
    <tr>
        <td>药品类别:<select ng-model="drug.drugCategoryName">
        <option value="1">儿童用药</option>
        </select>
        </td>
        <td>
            状态:<select ng-model="drug.drugStateName">
        <option value="2">正常</option>
            <option value="3">不正常</option>
        </select>
        </td>
    </tr>
    <tr>
        <td colspan="1" align="right"> <button type="button" class="btn1" ng-click="find()">查询</button></td>
        <td> <button type="button" class="btn1" onclick="loadlick()">导出</button></td>
    </tr>

</table>

</div>
    <div>
        <button type="button" class="btn1" data-toggle="modal" data-target="#addition" ng-click="addClick()">添加
        </button>
        <button type="button" class="btn1" ng-click="loadlick()">导入
        </button>
    </div>
         <div>
    <table id="dataList" class="table">
        <thead>
        <tr>
            <th></th>
            <th>药品品目号</th>
            <th>通用名</th>
            <th>剂型</th>
            <th>规格</th>
            <th>单位</th>
            <th>转换系数</th>
            <th>药品类别</th>
            <th>状态</th>
            <th>详细</th>
            <th>修改</th>
            <th>删除</th>
        </tr>
        </thead>

        <tbody id="tbody">
        <tr ng-repeat="x in lists">
            <td><input type="checkbox" name="pitchOn" value="{{x.diId}}" onchange="childrenCheck()" ></td>
            <td>{{x.diId}}</td>
            <td>{{x.commonName}}</td>
            <td>{{x.dosageForm}}</td>
            <td>{{x.speciflcation}}</td>
            <td>{{x.unitId}}</td>
            <td>{{x.coefficient}}</td>
            <td>{{x.drugCategoryName}}</td>
            <td>{{x.drugStateName}}</td>
            <td><button value="{{x.diId}}" onclick="drugdetail()" data-toggle="modal" data-target="#more">详细</button></td>
            <td><button value="{{x.diId}}" onclick="amend()">修改</button></td>
            <td><button value="{{x.diId}}" onclick="expurgate()">删除</button></td>
        </tr>
        </tbody>
    </table>
          <tm-pagination conf="paginationConf"></tm-pagination>
                </div>

<div class="modal fade" id="addition" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content" >
            <div class="modal-header">
                <button id="bt1" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h3 id="myModalLabel">药品品目添加</h3>
            </div>
            <div class="modal-body">
                <form id="addForm">
                <table class="table table-bordered table-striped"  >
                    <tr>
                        <td>药品品目号:</td>
                        <td><input name="diId"  onblur class="form-control">
                        <span></span></td>
                        <td>通用名:</td>
                        <td><input name="commonName" onblur  class="form-control" >
                        <span></span></td>
                    </tr>
                    <tr>

                        <td>剂型:</td>
                        <td><input name="dosageForm" onblur   class="form-control" >
                        <span></span></td>
                        <td>规格:</td>
                        <td><input name="speciflcation" onblur   class="form-control"  >
                        <span></span></td>
                    </tr>
                    <tr>
                        <td>单位:</td>
                        <td><input name="unitId" onblur   class="form-control" >
                            <span></span></td>
                        <td>转换系数:</td>
                        <td><input name="coefficient" onblur   class="form-control" >
                            <span></span></td>

                    </tr>
                    <tr>
                        <td>药品类别:</td>
                        <td><select  name="drugCategoryName" onblur class="form-control" >
                            <option value="1">儿童用药</option>
                        </select><span></span></td>
                        <td>状态:</td>
                        <td><select name="drugStateName" onblur  class="form-control" >
                            <option value="2">正常</option>
                            <option value="3">非正常</option>
                        </select><span></span></td>
                    </tr>
                </table>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-toggle="modal" data-dismiss="modal" data-target="#status" onclick="save()">保存</button>
                <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="status" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <h4>药品品目添加</h4>
                <h4 id="headline" type="text" style="width: 100%;height: 45px;display: block;line-height: 45px;text-align: center;"></h4>
                <p id="whether" type="text" style="width: 100%;height: 45px;display: block;line-height: 45px;text-align: center;"></p>
                <div>
                    <p id="lose" ></p>
                </div>
                <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="more" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <button id="bt" type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h3 id="myModalLabe">修改页面</h3>
            </div>
            <div class="modal-body">
                <form id="inserInto">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>单位名称:</td>
                            <td><input ng-model="xg.unitName" onblur class="form-control">
                                <span ></span>
                            </td>
                        </tr>
                        <tr>
                            <td>组织机构代码:</td>
                            <td><input ng-model="xg.organizationalCode" name="organizationalCode"  onblur class="form-control"></td>
                            <td>投诉人姓名:</td>
                            <td><input  ng-model="xg.nameOfTheComplainant" name="nameOfTheComplainant" onblur class="form-control"></td>
                            <td>投诉人身份证号:</td>
                            <td><input ng-model="xg.idCard" name="idCard" onblur  class="form-control">
                                <span></span>
                            </td>
                        </tr>
                        <tr>
                            <td>联系电话:</td>
                            <td><input  ng-model="xg.phone" name="phone" onblur class="form-control">
                                <span></span></td>
                            <td>接收人:</td>
                            <td><input  ng-model="xg.nameOfRegistrant" name="nameOfRegistrant"  class="form-control"></td>
                            <td>户口性质:</td>
                            <td><select  ng-model="xg.accountCharacter" name="accountCharacter"  class="form-control">
                                <option  value="0">农业户口</option>
                                <option  value="1">非农业户口</option>
                            </select></td>
                        </tr>
                        <tr>
                            <td>年龄:</td>
                            <td><input ng-model="xg.age" name="age"  class="form-control">
                            </td>
                            <td>性别:</td>
                            <td><select  name="sex" ng-model="xg.sex"  class="form-control">
                                <option value="0">男</option>
                                <option value="1">女</option>
                            </select></td>
                            <td>立案人:</td>
                            <td><input  ng-model="xg.nameOfTheFiler" name="nameOfTheFiler"  class="form-control">
                            <td>立案月</td>
                            <td><input ng-model="xg.filingMonth" name="filingMonth"  class="form-control"></td>
                        </tr>
                        <tr>
                            <td>投诉内容:</td>
                            <td><textarea  ng-model="xg.complaintContents" name="complaintContents" ></textarea></td>
                        </tr>
                    </table>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" ng-click="save()">保存</button>
                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>