<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../../static/plugins/jQuery/jquery-2.2.3.min.js"></script>
    <link rel="stylesheet" href="../../static/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../static/plugins/adminLTE/css/AdminLTE.css">
    <link rel="stylesheet" href="../../static/plugins/adminLTE/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../../static/css/style.css">
    <link rel="stylesheet" href="../../static/plugins/angularjs/toaster.min.css">
    <script src="../../static/plugins/bootstrap/js/bootstrap.min.js"></script>

    <script src="../../static/plugins/angularjs/angular.min.js"></script>
    <link rel="stylesheet" href="../../static/plugins/angularjs/pagination.css">
    <script type="text/javascript" src="../../static/plugins/angularjs/pagination.js"></script>
    <script src="../../static/js/showLoading.js" type="text/javascript" charset="utf-8"></script>

    <script>
        var app = angular.module("myApp", ["pagination"]);
        app.controller("myContr", function ($scope, $http) {
            $scope.paginationConf={
                currentPage: 1,  				//当前页
                totalItems: 10,					//总记录数
                itemsPerPage: 10,				//每页记录数
                perPageOptions: [5,10, 20, 30, 40, 50], //分页选项，下拉选择一页多少条记录
                onChange: function () {
                    $scope.find($scope.paginationConf.currentPage,$scope.paginationConf.itemsPerPage)
                }
            }
            $scope.drug={
                pageNum:0,
                pageSize:10
            }
            $scope.find=function(pageNum,items) {
                if (pageNum==null||pageNum==""){
                    pageNum=1;
                }
                $scope.drug.pageNum=pageNum;
                $scope.drug.pageSize=items;
                var druglist=$scope.drug;
                //console.log(druglist)
                $http({
                    url:"/Dictionaries/findAllDictionaries",
                    method:"post",
                    params: druglist
                }).success(function (response) {
                    $scope.lists=response.list;
                    $scope.paginationConf.totalItems=response.total;
                })

            }
            $scope.showModalButton1 =  function (slogan){
                showModal({
                    title: "温馨提示",  //提示的标题
                    content: slogan,  //提示的内容
                    showCancel: false,  //是否显示取消按钮，默认为 true
                    cancelText: '取消',  //取消按钮的文字，默认为"取消"，最多 4 个字符
                    cancelColor: "#fff",  //取消按钮的文字颜色，默认为"#000000"
                    cancelBgColor: '#4c4c4c',  //取消按钮的背景颜色
                    confirmText: '确定',
                    confirmColor: '#fff',
                    confirmBgColor: '#ff130a',
                    success: function() {

                    }
                });
            }
            $scope.showModalButton2 = function(){
                showModal({
                    title: "温馨提示",  //提示的标题
                    content: "确认要删除吗？",  //提示的内容
                    showCancel: true,  //是否显示取消按钮，默认为 true
                    cancelText: '取消',  //取消按钮的文字，默认为"取消"，最多 4 个字符
                    cancelColor: "#fff",  //取消按钮的文字颜色，默认为"#000000"
                    cancelBgColor: '#4c4c4c',  //取消按钮的背景颜色
                    confirmText: '确定',
                    confirmColor: '#fff',
                    confirmBgColor: '#ff1d31',
                    success: function(res) {
                        if (res.confirm) {
                            return true;
                        } else {
                            return false;
                        }
                    }
                });
            }
            $scope.toVerification = function(purchaseOrders){
                var judge = true;
                var purchaseName = purchaseOrders.purchaseName;
                var beginTime = purchaseOrders.beginTime;
                var endTime = purchaseOrders.endTime;
                var linkmanName = purchaseOrders.linkmanName;
                var linkmanPhone = purchaseOrders.linkmanPhone;
                var postscript =purchaseOrders.postscript;
                if (purchaseName==null||purchaseName==''){
                    $scope.showModalButton1("请修改订单名称！");
                    judge=false;
                }
                if (beginTime==null||beginTime==''){
                    $scope.showModalButton1("请填写订单供货时间！");
                    judge=false;
                }
                if (endTime==null||endTime==''){
                    $scope.showModalButton1("请填写订单结束供货时间！");
                    judge=false;
                }if (linkmanName==null||linkmanName==''){
                    $scope.showModalButton1("请填写联系人姓名！");
                    judge=false;
                }if (linkmanPhone==null||linkmanPhone==''){
                    $scope.showModalButton1("请填写联系人电话！");
                    judge=false;
                }if (postscript==null||postscript==''){
                    $scope.showModalButton1("请填写备注！");
                    judge=false;
                }
                if (beginTime>endTime){
                    $scope.showModalButton1("开始时间与结束时间有误！");
                    judge=false;
                }
                return judge;
            }
            //添加
            $scope.submit = function () {
                var purchaseOrders=$scope.entity;
                var judge =$scope.toVerification(purchaseOrders);
                if(judge) {
                    $http({
                        url: "/PurchaseOrders/addPurchaseOrders",
                        method: "post",
                        params: purchaseOrders
                    }).success(function (response) {
                        $scope.showModalButton1(response.slogan);
                        $("#editModal").modal('hide');//此处为添加框，关闭添加框
                        $scope.find($scope.paginationConf.currentPage, $scope.paginationConf.itemsPerPage);
                    })
                }
            }
            //修改显示数据
            $scope.reviseMassage = function (poId) {
                $http({
                    url: "/PurchaseOrders/getOnePurchaseOrders",
                    method: "post",
                    params: {"poId": poId}
                }).success(function (response) {
                    $scope.revise=response;
                })
            }
            $scope.reviseSave = function () {
                var purchaseOrders=$scope.revise;
                var judge =$scope.toVerification(purchaseOrders);

                if(judge) {
                    $http({
                        url: "/PurchaseOrders/changePurchaseOrders",
                        method: "post",
                        params: purchaseOrders
                    }).success(function (response) {
                        $scope.showModalButton1(response.slogan);
                        $("#modification").modal('hide');//此处为添加框，关闭添加框
                        $scope.find($scope.paginationConf.currentPage, $scope.paginationConf.itemsPerPage);
                    })
                }
            }
            //删除
            $scope.removeOne=function (poId) {
                showModal({
                    title: "温馨提示",  //提示的标题
                    content: "确认要删除吗？",  //提示的内容
                    showCancel: true,  //是否显示取消按钮，默认为 true
                    cancelText: '取消',  //取消按钮的文字，默认为"取消"，最多 4 个字符
                    cancelColor: "#fff",  //取消按钮的文字颜色，默认为"#000000"
                    cancelBgColor: '#4c4c4c',  //取消按钮的背景颜色
                    confirmText: '确定',
                    confirmColor: '#fff',
                    confirmBgColor: '#ff1d31',
                    success: function(res) {
                        if (res.confirm) {
                            $http({
                                url: "/PurchaseOrders/removePurchaseOrders",
                                method: "post",
                                params: {"poId": poId}
                            }).success(function (response) {
                                $scope.showModalButton1(response.slogan);
                                $scope.find($scope.paginationConf.currentPage, $scope.paginationConf.itemsPerPage);
                            })
                        }
                    }
                });

            }


        });

    </script>
</head>
<body ng-app="myApp" ng-controller="myContr">
<div>
    <h5 class="alert alert-infoalert alert-info">字典详情页</h5>
</div>
<div>
    <button type="button" class="btn btn-primary" style="margin-left: 35px" data-toggle="modal" data-target="#editModal" ng-click="addClick()">添加
    </button>
</div>
<div>
    <table id="dataList" class="table">
        <thead>
        <tr>
            <th><input type="checkbox" name="pitchOn" onchange="childrenCheck()"></th>
            <th>字典名称</th>
            <th>父级字典</th>
            <th>创建时间</th>
            <th>查看</th>
            <th>修改</th>
            <th>删除</th>
        </tr>
        </thead>

        <tbody id="tbody">
        <tr ng-repeat="dic in lists">
            <td><input type="checkbox" name="pitchOn" value="{{dic.dicId}}" onchange="childrenCheck()"></td>
            <td>{{dic.dictionariesName}}</td>
            <td>{{dic.parentName}}</td>
            <td>{{dic.purchaseName}}</td>
            <td><button class="btn btn-success"  onclick="drugdetail()" data-toggle="modal" >详细</button></td>
            <td><button class="btn btn-warning" data-toggle="modal" data-target="#modification" ng-click="reviseMassage(dic.poId)">修改</button></td>
            <td><button class="btn btn-danger"  ng-click="removeOne(dic.poId)">删除</button></td>
        </tr>
        </tbody>
    </table>
    <tm-pagination conf="paginationConf"></tm-pagination>
</div>

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <button id="bt1" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h3 id="myModalLabel">采购单添加</h3>
            </div>
            <div class="modal-body">

                <table class="table table-bordered table-striped">
                    <tr>
                        <td>医院编号:</td>
                        <td><input  name="hospitalNumber" ng-model="hospital.hospitalNumber"  class="form-control" disabled="disabled"></td>
                        <td>医院名称:</td>
                        <td><input name="hospitalName" ng-model="hospital.hospitalName" class="form-control" disabled="disabled">
                        </td>
                    </tr>
                    <tr>

                        <td>采购单编号:</td>
                        <td><input  name="purchaseNumber"
                                    ng-model="entity.purchaseNumber" class="form-control" disabled="disabled"></td>
                        <td>采购单名称:</td>
                        <td><input  name="purchaseName" ng-model="entity.purchaseName" class="form-control" ></td>
                    </tr>
                    <tr>
                        <td>供货时间:</td>
                        <td><input  name="beginTime"
                                    ng-model="entity.beginTime"  type="date">-
                            <input  name="endTime"
                                    ng-model="entity.endTime"  type="date">
                        </td>
                        <td>建单时间:</td>
                        <td><input  name="fundTime"
                                    ng-model="entity.fundTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>联系人:</td>
                        <td><input  name="linkmanName"
                                    ng-model="entity.linkmanName" class="form-control"></td>
                        <td>联系电话:</td>
                        <td><input  name="linkmanPhone"
                                    ng-model="entity.linkmanPhone" class="form-control"></td>
                    </tr>
                    <tr>
                        <td>采购单状态:</td>
                        <td><input  name="purchaseState"
                                    ng-model="entity.purchaseState" class="form-control" disabled="disabled"></td>
                        <td>提交时间:</td>
                        <td><input  name="modifiedTime"
                                    ng-model="entity.modifiedTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>备注:</td>
                        <td><input  name="postscript"
                                    ng-model="entity.postscript" class="form-control" ></td>
                    </tr>
                    <tr>
                        <td>审核人:</td>
                        <td><input  name="userId"
                                    ng-model="entity.userId" class="form-control" disabled="disabled"></td>
                        <td>审核时间:</td>
                        <td><input  name="auditTime"
                                    ng-model="entity.auditTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>审核意见:</td>
                        <td><input  name="auditOpinion"
                                    ng-model="entity.auditOpinion" class="form-control"  disabled="disabled"></td>
                    </tr>
                </table>

            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="submit()">提交</button>
                <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modification" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <button id="bt" type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h3 id="myModalLabe">采购单修改</h3>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>医院编号:</td>
                        <td><input  ng-model="revise.hospitalNumber"  class="form-control" disabled="disabled"></td>
                        <td>医院名称:</td>
                        <td><input ng-model="revise.hospitalName" class="form-control" disabled="disabled">
                        </td>
                    </tr>
                    <tr>

                        <td>采购单编号:</td>
                        <td><input  ng-model="revise.purchaseNumber" class="form-control" disabled="disabled"></td>
                        <td>采购单名称:</td>
                        <td><input  ng-model="revise.purchaseName" class="form-control" ></td>
                    </tr>
                    <tr>
                        <td>供货时间:</td>
                        <td><input  ng-model="revise.beginTime"  type="date">-
                            <input  ng-model="revise.endTime"  type="date">
                        </td>
                        <td>建单时间:</td>
                        <td><input  ng-model="revise.fundTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>联系人:</td>
                        <td><input  ng-model="revise.linkmanName" class="form-control"></td>
                        <td>联系电话:</td>
                        <td><input  ng-model="revise.linkmanPhone" class="form-control"></td>
                    </tr>
                    <tr>
                        <td>采购单状态:</td>
                        <td><input  ng-model="revise.purchaseState" class="form-control" disabled="disabled"></td>
                        <td>提交时间:</td>
                        <td><input  ng-model="revise.modifiedTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>备注:</td>
                        <td><input  ng-model="revise.postscript" class="form-control" ></td>
                    </tr>
                    <tr>
                        <td>审核人:</td>
                        <td><input  ng-model="revise.userId" class="form-control" disabled="disabled"></td>
                        <td>审核时间:</td>
                        <td><input  ng-model="revise.auditTime" class="form-control" disabled="disabled"></td>

                    </tr>
                    <tr>
                        <td>审核意见:</td>
                        <td><input  ng-model="revise.auditOpinion" class="form-control"  disabled="disabled"></td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" data-dismiss="modal" ng-click="reviseSave()">保存</button>
                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>